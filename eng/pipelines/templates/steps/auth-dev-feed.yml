parameters:
  DevFeedName: 'public/azure-sdk-for-python'

steps:
  - pwsh: |
      # For safety default to publishing to the private feed.
      # Publish to https://dev.azure.com/azure-sdk/internal/_packaging?_a=feed&feed=azure-sdk-for-python-pr
      $devopsFeedName = 'internal/azure-sdk-for-python-pr'
      if ('$(Build.Repository.Name)' -eq 'Azure/azure-sdk-for-python') {
        # Publish to https://dev.azure.com/azure-sdk/public/_packaging?_a=feed&feed=azure-sdk-for-python
        $devopsFeedName = '${{ parameters.DevFeedName }}'
      }
      echo "##vso[task.setvariable variable=DevFeedName]$devopsFeedName"
      echo "Using DevopsFeed = $devopsFeedName"
    displayName: Setup DevOpsFeedName

  - task: TwineAuthenticate@0
    displayName: 'Twine Authenticate to feed'
    inputs:
      artifactFeeds: $(DevFeedName)

  - task: PipAuthenticate@1
    displayName: 'Pip Authenticate to feed'
    inputs:
      artifactFeeds: $(DevFeedName)
      onlyAddExtraIndex: false

  # Disabled UV authentication step - for future enablement when UV fully supports Azure Artifacts
  # To enable: uncomment this step and ensure UV_INDEX_URL is properly configured
  # The PipAuthenticate task above creates a .pypirc file in the home directory that UV can use
  - pwsh: |
      # This step configures UV to use the same authentication as pip
      # UV will read credentials from ~/.pypirc created by PipAuthenticate task
      if ($env:PIP_INDEX_URL) {
        Write-Host "PIP Index URL detected: $env:PIP_INDEX_URL"
        # Uncomment the next line to enable UV authentication
        # Write-Host "##vso[task.setvariable variable=UV_INDEX_URL]$($env:PIP_INDEX_URL)"
        Write-Host "UV authentication is currently disabled. To enable, uncomment the variable assignment above."
      }
    displayName: 'Configure UV Authentication (Disabled)'
    condition: false  # Explicitly disabled - change to 'true' or remove to enable
